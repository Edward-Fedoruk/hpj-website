---
import { Image } from "astro:assets";
import type { StrapiImageType } from "@/types/common";
import { buildStrapiResponsive } from "@/utils/strapiImg";

const { title, subTitle, sliderItems } = Astro.props;

interface Props {
  title: string;
  subTitle?: string;
  sliderItems?: UnitSliderItem[];
}

export interface UnitSliderItem {
  title: string;
  description: string | null;
  url: string | null;
  img: StrapiImageType;
  imgAlt: string | null;
}
---

<section
  class="mx-auto flex flex-col gap-8 overflow-hidden bg-[var(--color-gray-10)] px-4 py-[100px] sm:px-6 md:items-center md:gap-8 md:py-[120px] lg:px-8 xl:px-10"
  data-aos="fade-up"
  data-aos-delay="150"
  data-aos-once="true"
>
  <h1
    class="block text-center font-(family-name:--font-helvetica-bold) text-3xl font-bold tracking-tight text-balance whitespace-pre-line text-[var(--color-primary-text)] sm:text-4xl lg:text-6xl lg:leading-tight dark:text-neutral-200"
  >
    <Fragment set:html={title} />
  </h1>
  {
    subTitle && (
      <p class="mx-auto w-full max-w-[846px] text-center text-lg leading-relaxed text-pretty text-[var(--color-secondary-text)]">
        {subTitle}
      </p>
    )
  }

  {
    sliderItems && sliderItems.length > 0 && (
      <div class="embla mb-[72px] h-fit max-h-[323px] md:max-h-[420px]" id="units-slider">
        <div class="embla__container">
          {sliderItems.map((item) => {
            const itemImg = buildStrapiResponsive(item.img);

            return (
              <a
                class="embla__slide group h-fit max-h-[323px] max-w-[412px] cursor-pointer overflow-hidden rounded-xl shadow-[0px_8px_16px_0px_#00000014,0px_0px_4px_0px_#0000000A] duration-300 hover:max-h-[800px] md:max-h-[420px]"
                href={item.url}
              >
                {itemImg ? (
                  <Image
                    src={itemImg.src}
                    alt={item.imgAlt || item.img.alternativeText}
                    height={itemImg.height}
                    width={itemImg.width}
                    class={"h-[154px] object-cover md:h-[280px]"}
                    sizes="(max-width: 500px) 500px, 100vw"
                    draggable={"false"}
                    loading={"eager"}
                    fetchpriority={"high"}
                  />
                ) : (
                  <div>Image placeholder</div>
                )}
                <div class="min-h-[128px] p-4">
                  <p class="mt-2 mb-2 line-clamp-1 text-2xl font-bold text-[var(--color-primary-text)]">{item.title}</p>
                  <p class="line-clamp-2 max-h-[55px] text-base font-normal text-[var(--color-secondary-text)] duration-300 group-hover:line-clamp-6 group-hover:max-h-[1500px]">
                    {item.description}
                  </p>
                </div>
              </a>
            );
          })}
        </div>
        <div class="embla__controls">
          <div class="embla__buttons mt-6 flex justify-center gap-4">
            <button class="embla__button embla__button--prev" type="button">
              <svg class="embla__button__svg" viewBox="0 0 532 532">
                <path
                  fill="currentColor"
                  d="M355.66 11.354c13.793-13.805 36.208-13.805 50.001 0 13.785 13.804 13.785 36.238 0 50.034L201.22 266l204.442 204.61c13.785 13.805 13.785 36.239 0 50.044-13.793 13.796-36.208 13.796-50.002 0a5994246.277 5994246.277 0 0 0-229.332-229.454 35.065 35.065 0 0 1-10.326-25.126c0-9.2 3.393-18.26 10.326-25.2C172.192 194.973 332.731 34.31 355.66 11.354Z"
                />
              </svg>
            </button>

            <button class="embla__button embla__button--next" type="button">
              <svg class="embla__button__svg" viewBox="0 0 532 532">
                <path
                  fill="currentColor"
                  d="M176.34 520.646c-13.793 13.805-36.208 13.805-50.001 0-13.785-13.804-13.785-36.238 0-50.034L330.78 266 126.34 61.391c-13.785-13.805-13.785-36.239 0-50.044 13.793-13.796 36.208-13.796 50.002 0 22.928 22.947 206.395 206.507 229.332 229.454a35.065 35.065 0 0 1 10.326 25.126c0 9.2-3.393 18.26-10.326 25.2-45.865 45.901-206.404 206.564-229.332 229.52Z"
                />
              </svg>
            </button>
          </div>
        </div>
      </div>
    )
  }
</section>

{
  // Slider styles
}

<style>
  .embla {
    width: 100%;
    max-width: 1280px;
    --slide-height: 19rem;
    --slide-spacing: 2rem;
    --slide-size: 30%;
  }
  @media screen and (max-width: 768px) {
    .embla {
      --slide-size: 70%;
    }
  }
  .embla__viewport {
    overflow: hidden;
  }
  .embla__container {
    display: flex;
    touch-action: pan-y pinch-zoom;
    margin-left: calc(var(--slide-spacing) * -1);
  }
  .embla__slide {
    transform: translate3d(0, 0, 0);
    flex: 0 0 var(--slide-size);
    min-width: 0;
    margin-left: var(--slide-spacing);
  }
  .embla__slide__number {
    box-shadow: inset 0 0 0 0.2rem var(--detail-medium-contrast);
    border-radius: 1.8rem;
    font-size: 4rem;
    font-weight: 600;
    display: flex;
    align-items: center;
    justify-content: center;
    height: var(--slide-height);
    user-select: none;
  }
</style>

{
  // Slider script
}

<script>
  import EmblaCarousel, { type EmblaOptionsType } from "embla-carousel";
  import { addPrevNextBtnsClickHandlers } from "@scripts/emblaSliderButtons";

  const emblaNode = document.querySelector("#units-slider");
  const options: EmblaOptionsType = { loop: false, align: "start", dragFree: true };
  const emblaApi = EmblaCarousel(emblaNode! as HTMLElement, options);

  const prevBtnNode = emblaNode!.querySelector(".embla__button--prev") as HTMLElement;
  const nextBtnNode = emblaNode!.querySelector(".embla__button--next") as HTMLElement;

  const removePrevNextBtnsClickHandlers = addPrevNextBtnsClickHandlers(emblaApi, prevBtnNode, nextBtnNode);

  emblaApi.on("destroy", removePrevNextBtnsClickHandlers);
</script>
