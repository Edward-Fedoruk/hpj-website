---
import SectionCorner from "../../SectionCorner.astro";
import RoadMapItem from "./RoadMapItem.astro";
import type { IRoadMapItem } from "./RoadMapItem.astro";

const { title, roadMapItems } = Astro.props;

export interface RoadMapSectionProps {
  title: string;
  roadMapItems?: IRoadMapItem[];
}

interface Props extends RoadMapSectionProps {}
---

<section
  class="relative mx-auto gap-8 bg-[var(--color-primary)] px-4 py-[100px] selection:bg-white! selection:text-[#524CF2]! md:items-center md:gap-8 md:py-[134px] xl:px-10"
>
  <SectionCorner className="text-[var(--color-gray-10)]" position="top-left" />
  <SectionCorner className="text-[white]" position="bottom-right" />

  <div
    class="m-auto flex max-w-[85rem] flex-col text-white"
    data-aos="fade-up"
    data-aos-delay="150"
    data-aos-once="true"
  >
    <h1
      class="block text-center font-(family-name:--font-helvetica-bold) text-[32px] font-bold tracking-tight text-balance whitespace-pre-line sm:text-4xl md:text-[52px] lg:text-6xl lg:leading-tight dark:text-neutral-200"
    >
      <Fragment set:html={title} />
    </h1>

    {
      roadMapItems && (
        <div class="mt-[90px] flex w-full flex-col items-center justify-center sm:flex-row" id="road-map-titles">
          {roadMapItems.map((item, index) => {
            if (index < roadMapItems.length && index === roadMapItems.length - 1) {
              return (
                <div class="relative flex h-[280px] flex-1 flex-col items-center gap-4">
                  <RoadMapItem {...item} index={index} />
                  <div class="absolute top-[3px] left-0 -z-10 mt-6 hidden h-[110px] w-[1px] rotate-90 bg-white opacity-50 sm:block" />
                  <div class="absolute top-[3px] right-0 -z-10 mt-6 hidden h-[110px] w-[1px] rotate-90 bg-white opacity-50 sm:block" />
                </div>
              );
            }
            if (index < roadMapItems.length && index !== roadMapItems.length - 1) {
              return (
                <div class="relative flex h-[280px] flex-1 flex-col items-center gap-4">
                  <RoadMapItem {...item} index={index} />
                  <div class="absolute top-[3px] left-0 -z-10 mt-6 hidden h-[110px] w-[1px] rotate-90 bg-white opacity-50 sm:block" />
                </div>
              );
            }
            return <RoadMapItem {...item} index={index} />;
          })}
        </div>
      )
    }
    {
      roadMapItems && (
        <div
          class="mx-auto mt-10 flex w-full max-w-[910px] flex-col items-center justify-center text-center"
          id="road-map-descriptions"
        >
          {roadMapItems.map((item) => {
            return <p class="hidden text-center text-[18px]">{item.description}</p>;
          })}
        </div>
      )
    }
  </div>
</section>

<style is:global>
  #road-map-titles .selected p {
    font-weight: 700;
  }
  #road-map-titles .selected .square {
    background-color: #ffffff40;
  }
</style>

<script>
  const roadMapTitlesWrapper = document.querySelector("#road-map-titles") as HTMLElement;
  const roadMapDescriptionsWrapper = document.querySelector("#road-map-descriptions") as HTMLElement;

  if (roadMapTitlesWrapper && roadMapDescriptionsWrapper) {
    const allItems = roadMapTitlesWrapper.querySelectorAll(`[data-item-index]`) as NodeListOf<HTMLElement>;

    allItems.forEach((item) => {
      const square = item.querySelector(".square");
      if (square) {
        square.addEventListener("click", () => {
          selectItem(item.dataset.itemIndex ? Number.parseInt(item.dataset.itemIndex) : 0);
        });
      }
    });
  }

  function selectItem(itemNumber: number) {
    if (!roadMapTitlesWrapper) return;
    if (!roadMapDescriptionsWrapper) return;

    const allItems = roadMapTitlesWrapper.querySelectorAll(`[data-item-index]`) as NodeListOf<HTMLElement>;

    allItems.forEach((item) => {
      item.classList.remove("selected");

      if (item.dataset.itemIndex) {
        if (Number.parseInt(item.dataset.itemIndex) === itemNumber) {
          item.classList.add("selected");
        }
      }
    });

    const allDescriptions = roadMapDescriptionsWrapper.querySelectorAll("p") as NodeListOf<HTMLElement>;

    allDescriptions.forEach((descItem) => {
      descItem.classList.add("hidden");

      allDescriptions[itemNumber].classList.remove("hidden");
    });
  }

  selectItem(0);
</script>
