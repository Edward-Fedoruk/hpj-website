---
// Import the necessary components
import HeroSection from "@/components/sections/landing/HeroSection.astro";
import MainLayout from "@/layouts/MainLayout.astro";
import AboutSection from "@/components/sections/landing/AboutSection.astro";
import heroImage from "@images/hero-image.jpg";
import BusinessUnitsSection from "@/components/sections/landing/BusinessUnitsSection.astro";
import WhyUsSection from "@/components/sections/landing/WhyUsSection.astro";

import prosIcon1 from "@images/pros/pros1.svg?raw";
import prosIcon2 from "@images/pros/pros2.svg?raw";
import prosIcon3 from "@images/pros/pros3.svg?raw";
import prosIcon4 from "@images/pros/pros4.svg?raw";
import BoardSection from "@/components/sections/misc/BoardSection.astro";

import NewsSection from "@/components/sections/misc/NewsSection.astro";
import ContactFormSection from "@/components/sections/misc/ContactFormSection.astro";

const newsArray = [
  {
    title: "Launches New Training Programs",
    date: new Date("September 23, 2025 10:30:00"),
    url: "post1",
    description:
      "HPJ Management Consultancy is proud to announce HPJ Management Consultancy is proud to announce HPJ Management Consultancy is proud to announce",
    img: {
      src: "/news1.png",
      alt: "news img 1",
      width: 100,
      height: 100,
    },
  },
  {
    title: "Launches New Training Programs 2",
    date: new Date("September 23, 2025 10:30:00"),
    url: "post1",
    description: "desc2",
    img: {
      src: "/news1.png",
      alt: "news img 1",
      width: 100,
      height: 100,
    },
  },
  {
    title: "Launches New Training Programs 3",
    date: new Date("September 23, 2025 10:30:00"),
    url: "post1",
    description: "desc3",
    img: {
      src: "/news1.png",
      alt: "news img 1",
      width: 100,
      height: 100,
    },
  },
];

// helpers
const STRAPI_URL = import.meta.env.PUBLIC_STRAPI_URL || "http://localhost:1337";

function mediaUrl(m: any) {
  if (!m?.data?.attributes?.url) return "";
  const url = m.data.attributes.url;
  return url.startsWith("http") ? url : `${STRAPI_URL}${url}`;
}

// 1) тягнемо сторінку з секціями (populate для DZ)
const slug = "empowering-growth-across-diverse-business-divisions"; // підставляй з маршруту
const res = await fetch(`${STRAPI_URL}/api/pages`);
const json = await res.json();
const page = json?.data?.[0];
const sections = page?.attributes?.sections || [];

// Структура залежить від твоєї схеми в Strapi (назви полів маєш із компонента Sections > Hero)
function mapHero(b: any) {
  return {
    title: b.title,
    subTitle: b.subtitle,
    primaryBtn: b.primary_button_label || undefined,
    primaryBtnURL: b.primary_button_link || undefined,
    secondaryBtn: b.secondary_button_label || undefined,
    secondaryBtnURL: b.secondary_button_link || undefined,
    src: mediaUrl(b.background_image),
    alt: b.background_image?.data?.attributes?.alternativeText || "Hero image",
    alignment: b.alignment || "center",
    // якщо твій HeroSection підтримує ще якісь пропси — докинь тут
  };
}

// приклади інших блоків, якщо їх винесеш у Strapi
function mapAbout(b: any) {
  return {
    title: b.title,
    subTitle: b.subtitle,
    secondaryBtn: b.cta_label || undefined,
    secondaryBtnURL: b.cta_link || undefined,
  };
}

function mapWhyUs(b: any) {
  const pros = (b.items || []).map((i: any) => ({
    iconStr: i.icon_svg_raw || "", // або mediaUrl(i.icon) якщо це медіа
    title: i.title,
    description: i.description,
  }));
  return {
    title: b.title,
    subTitle: b.subtitle,
    prosList: pros,
  };
}
---

<MainLayout>
  <HeroSection
    title="Empowering Growth Across Diverse Business Divisions"
    subTitle="Built on quality, driven by expertise, trusted by clients"
    primaryBtn="Contact Us"
    primaryBtnURL="/contacts"
    secondaryBtn="Explore Busines Units"
    secondaryBtnURL="/units"
    src={heroImage}
    alt="Main banner"
  />

  <AboutSection
    title="About HPJ"
    subTitle="As a multi-division business, we bring together expertise, innovation, and collaboration to deliver excellence across industries and create long-term value."
    secondaryBtn="About Us"
    secondaryBtnURL="/contacts"
  />

  <BusinessUnitsSection
    title="Our Business Units"
    subTitle="A Strategic Network of Specialized Divisions"
    secondaryBtn="About Us"
    secondaryBtnURL="/contacts"
  />

  <WhyUsSection
    title="Why HPJ?"
    prosList={[
      {
        iconStr: prosIcon1,
        title: "Unmatched Quality",
        description:
          "We hold ourselves to the highest standards, ensuring excellence in every division",
      },
      {
        iconStr: prosIcon2,
        title: "Trusted Expertise",
        description:
          "With years of proven experience, our teams deliver results you can rely on.",
      },
      {
        iconStr: prosIcon3,
        title: "Professionalism at Every Step",
        description:
          "From strategy to execution, we bring integrity, efficiency, and commitment.",
      },
      {
        iconStr: prosIcon4,
        title: "Multi-Division Strength",
        description:
          "Our diverse business divisions work together to provide comprehensive solutions tailored to your needs.",
      },
    ]}
  />

  <BoardSection
    items={[
      {
        title: "The Board",
        description:
          "We lead with experience, driven by professionalism, and guided by a commitment to lasting success.",
        img: {
          src: "/boardImg1.png",
          alt: "img1 alt",
          width: 500,
          height: 334,
        },
      },
    ]}
  />

  <NewsSection
    title="Inside HPJ"
    subTitle="Contracts signed, partnerships launched, people promoted. Stay current."
    newsArray={newsArray}
  />

  <ContactFormSection
    title="Join Our Team"
    subTitle="Looking to grow your career with a forward-thinking organization? Join our dynamic team today"
  />
</MainLayout>
