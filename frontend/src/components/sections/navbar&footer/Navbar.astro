---
//Import relevant dependencies
import NavLink from "@components/ui/links/NavLink.astro";
import enStrings from "@utils/navigation.ts";
import BrandLogo from "@components/BrandLogo.astro";
import PrimaryCTA from "@components/ui/buttons/PrimaryCTA.astro";
import MegaMenuLink from "@/components/ui/links/MegaMenuLink.astro";

// Select the correct translation based on the page's lang prop:
const strings = enStrings;
const homeUrl = "/";

---

<!-- Main header component -->
<header
  class="fixed inset-x-0 top-2 z-50 mx-auto flex w-full max-w-[1320px] max-h-[calc(100%-32px)] lg:max-h-full overflow-hidden overflow-y-auto lg:overflow-visible lg:overflow-y-visible flex-wrap px-5 text-sm lg:flex-nowrap lg:justify-start"
  style="color:white"
>
  <div class="relative w-full h-fit">
  <!-- Navigation container -->
    <nav
      class="block w-full rounded-3xl border border-[#FFFFFF1A] bg-black/10 p-[8px_20px] backdrop-blur-md duration-300 has-[.open]:bg-black/30 lg:flex lg:items-center lg:justify-between lg:rounded-[18px] lg:p-4 lg:has-[.open]:bg-black/10 xl:mx-auto"
      aria-label="Global"
    >
      <div class="flex w-full min-w-[74px] items-center justify-between lg:w-fit">
        <!-- Brand logo -->
        <a
          class="flex-none rounded-lg text-xl font-bold ring-zinc-500 outline-hidden focus-visible:ring-3 lg:absolute lg:top-4 lg:left-4 dark:ring-zinc-200 dark:focus:outline-hidden"
          href={homeUrl}
          aria-label="Brand"
        >
          <BrandLogo class="h-8 w-9 object-contain lg:h-[60px] lg:w-[74px]" />
        </a>
        <!-- Collapse toggle for smaller screens -->
        <div class="ml-auto text-white lg:hidden">
          <button
            type="button"
            class="hs-collapse-toggle flex h-8 w-8 items-center justify-center rounded-full text-sm font-bold transition duration-300 hover:bg-neutral-200 disabled:pointer-events-none disabled:opacity-50 lg:text-neutral-600 dark:text-neutral-400 dark:hover:bg-neutral-700 dark:focus:outline-hidden"
            data-hs-collapse="#navbar-collapse-with-animation"
            aria-controls="navbar-collapse-with-animation"
            aria-label="Toggle navigation"
          >
            <svg
              class="hs-collapse-open:hidden h-[30px] w-[30px] shrink-0"
              width="24"
              height="24"
              viewBox="0 0 24 24"
              fill="none"
              stroke="currentColor"
              stroke-width="2"
              stroke-linecap="round"
              stroke-linejoin="round"
            >
              <line x1="3" x2="21" y1="6" y2="6"></line>
              <line x1="3" x2="21" y1="12" y2="12"></line>
              <line x1="3" x2="21" y1="18" y2="18"></line>
            </svg>
            <svg
              class="hs-collapse-open:block hidden h-[30px] w-[30px] shrink-0"
              width="30"
              height="30"
              viewBox="0 0 24 24"
              fill="none"
              stroke="currentColor"
              stroke-width="2"
              stroke-linecap="round"
              stroke-linejoin="round"
            >
              <path d="M18 6 6 18"></path>
              <path d="m6 6 12 12"></path>
            </svg>
          </button>
        </div>
      </div>
      <!-- Contains navigation links -->
      <div
        id="navbar-collapse-with-animation"
        class="hs-collapse hidden grow basis-full overflow-hidden transition-all duration-300 lg:block"
      >
        <!-- Navigation links container -->
        <div
          class="flex flex-col items-center gap-x-0 gap-y-4 lg:flex-row lg:items-center lg:justify-center lg:gap-x-4 lg:gap-y-0 lg:gap-x-7"
        >
          <!-- Navigation links -->
          {
            strings.navBarLinks.map((link, index) => {
              if (link.url.includes("units")) {
                return <MegaMenuLink url={link.url} name={link.name} />;
              } else {
                return <NavLink url={link.url} name={link.name} width={link.width} />;
              }
            })
          }
          <div class="mb-2 block min-w-fit lg:hidden">
            <PrimaryCTA title={"Contact Us"} url={"/contact"} noArrow className="h-14 min-w-[174px]" />
          </div>
        </div>
      </div>
      <div class="hidden min-w-fit lg:block">
        <PrimaryCTA title={"Contact Us"} url={"/contact"} noArrow className="h-14 min-w-[120px] lg:min-w-[174px]" />
      </div>
    </nav>
  </div>

</header>

<script>
  const dynamicNavbarTextColorInit = () => {
    const header = document.querySelector("header");
    const sections = document.querySelectorAll("section");

    if (!header || !sections.length) return;

    const observer = new IntersectionObserver(
      (entries) => {
        entries.forEach((entry) => {
          if (entry.isIntersecting) {
            const isDark = entry.target.classList.contains("header-text-dark");
            header.style.color = isDark ? "var(--color-text-main)" : "white";
          }
        });
      },
      {
        threshold: 0,
        rootMargin: `0px 0px -90% 0px`,
      }
    );

    sections.forEach((section) => observer.observe(section));
  };

  dynamicNavbarTextColorInit();
</script>
